apiVersion: apisix.apache.org/v2
kind: ApisixRoute
metadata:
  name: dummy-service-route
  namespace: test
  annotations:
    ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: letsencrypt-prod
    argocd.argoproj.io/sync-wave: "2"
spec:
  http:
  - name: dummy-service
    match:
      hosts:
      - iam-test.develop.eoepca.org
      paths:
      - /*
    backends:
    - serviceName: dummy-service
      servicePort: 80
#    plugins:
#    - name: openid-connect
#      enable: true
#      config:
#        client_id: "test-realm"
#        # TODO: Set client secret
#        client_secret: "TBD"
#        #bearer_only: true
#        #realm: "eoepca"
#        #redirect_uri: "http://iam-test.develop.eoepca.org/"
#        access_token_in_authorization_header: true
#        discovery: "http://iam-auth.develop.eoepca.org/realms/eoepca/.well-known/openid-configuration"
#    - name: authz-keycloak
#      enable: true
#      config:
#        client_id: "test-realm"
#        # TODO: Set client secret
#        client_secret: "TBD"
#        discovery: "http://iam-auth.develop.eoepca.org/realms/eoepca/.well-known/uma2-configuration"
#        #permissions: "Resource all"
#        lazy_load_paths: true
